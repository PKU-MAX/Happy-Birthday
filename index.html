<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å°ç« é±¼å¤§å†’é™©ï¼šæ··ä¹±æµ·åŸŸ</title>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
    <style>
        /* --- 1. åŸºç¡€è®¾ç½® --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0; overflow: hidden;
            font-family: 'ZCOOL KuaiLe', cursive, sans-serif;
            background-color: #333;
            user-select: none; -webkit-user-select: none;
            touch-action: none; /* ç¦æ­¢æµè§ˆå™¨é»˜è®¤æ‰‹åŠ¿ */
        }

        /* --- 2. æ¸¸æˆå®¹å™¨ --- */
        #gameWrapper {
            position: absolute; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%);
            z-index: 100;
            overflow: hidden;
            transition: transform 0.8s ease-in;
        }

        canvas#gameCanvas { display: block; width: 100%; height: 100%; }

        /* --- 3. UI ç•Œé¢ (HUD) --- */
        .hud {
            position: absolute; top: 10px; left: 10px; right: 10px;
            display: flex; justify-content: space-between; align-items: start;
            pointer-events: none; z-index: 20;
        }

        /* ç”Ÿå‘½å€¼çˆ±å¿ƒ */
        .life-container {
            font-size: 1.5rem; color: #ff6b6b;
            background: rgba(255,255,255,0.8);
            padding: 5px 15px; border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* åˆ†æ•°æ¿ */
        .score-board {
            text-align: right;
            background: rgba(255,255,255,0.9);
            padding: 8px 15px; border-radius: 20px;
            border: 3px solid #ffd700;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .score-big { font-size: 2rem; color: #ff6b6b; font-weight: bold; }
        .score-sub { font-size: 1rem; color: #666; }

        /* --- 4. å¼¹çª—ä¸æ§åˆ¶å±‚ --- */
        .ui-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.4);
            z-index: 50;
            backdrop-filter: blur(3px);
        }
        .hidden { display: none !important; }

        .card {
            background: #fff; width: 85%; max-width: 350px;
            padding: 25px; border-radius: 25px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            border: 5px solid #ff9ff3;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        h2 { margin: 0 0 10px; color: #333; font-size: 1.8rem; }
        p { color: #666; font-size: 1.1rem; line-height: 1.5; margin-bottom: 20px; }
        
        button.btn {
            background: linear-gradient(to right, #ff9ff3, #feca57);
            border: none; padding: 12px 35px;
            font-size: 1.3rem; color: white; border-radius: 50px;
            cursor: pointer; font-family: inherit;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
            transition: transform 0.1s;
            outline: none;
            /* å…³é”®ï¼šç¡®ä¿æŒ‰é’®å¯ç‚¹å‡» */
            pointer-events: auto;
            touch-action: manipulation;
        }
        button.btn:active { transform: scale(0.95); background: #ff6b6b; }

        /* --- 5. åº†ç¥é¡µé¢ --- */
        #celebrationWrapper {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; opacity: 0;
            background: linear-gradient(135deg, #2a0845 0%, #6441a5 100%);
            justify-content: center; align-items: center;
            z-index: 200; transition: opacity 1.5s;
        }
        .cel-content { position: relative; z-index: 10; text-align: center; color: white; }
        
        /* çº¯CSS ç« é±¼å±•ç¤º */
        .oct-show { position: relative; width: 160px; height: 180px; margin: 0 auto 20px; animation: float 3s infinite ease-in-out; }
        .oct-head { width: 140px; height: 130px; background: #ff9aa2; border-radius: 50% 50% 45% 45%; position: relative; }
        .oct-eye { position: absolute; top: 45px; width: 32px; height: 40px; background: #333; border-radius: 50%; }
        .oct-eye.l { left: 28px; } .oct-eye.r { right: 28px; }
        .oct-eye::after{ content:''; position:absolute; top:8px; left:8px; width:12px; height:12px; background:#fff; border-radius:50%;}
        .oct-mouth { position: absolute; bottom: 20px; left: 50%; transform: translate(-50%); width: 20px; height: 10px; border-bottom: 4px solid #d63384; border-radius:0 0 50% 50%; }
        .hat-final { position: absolute; top: -60px; left: 10px; font-size: 80px; transform: rotate(-15deg); }
        h1.win-title { font-size: 3rem; margin: 10px 0; text-shadow: 0 5px 15px rgba(0,0,0,0.5); }

        @keyframes popIn { 0%{transform: scale(0.5); opacity:0} 100%{transform: scale(1); opacity:1} }
        @keyframes float { 0%,100%{transform: translateY(0)} 50%{transform: translateY(-20px)} }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 100% { transform: translate(-1px, -2px) rotate(-1deg); } }

    </style>
</head>
<body>

    <div id="gameWrapper">
        <canvas id="gameCanvas"></canvas>
        
        <!-- æ¸¸æˆä¸­çš„æ˜¾ç¤º -->
        <div class="hud">
            <div class="life-container" id="lifeEl">â¤â¤â¤</div>
            <div class="score-board">
                <div class="score-big"><span id="scoreEl">0</span>/23</div>
                <div class="score-sub">æ”¶é›†å¸½å­</div>
            </div>
        </div>

        <!-- 1. å¼€å§‹èœå• -->
        <div class="ui-overlay" id="startScreen">
            <div class="card">
                <h2>ğŸ™ æ··ä¹±æµ·åŸŸ</h2>
                <p>å°ç« é±¼çš„23å²ç”Ÿæ—¥åˆ°äº†ï¼<br>æ”¶é›† <b style="color:#feca57">23</b> ä¸ªå¸½å­æ¥å¼€æ´¾å¯¹ï¼</p>
                <p style="font-size:0.9rem; text-align:left; background:#f0f0f0; padding:10px; border-radius:10px;">
                    <b>âœ¨ ç©æ³•ï¼š</b><br>
                    ğŸ‘† æŒ‰ä½å±å¹• = ä¸Šæµ®<br>
                    ğŸ‘‡ æ¾æ‰‹ = ä¸‹æ½œ<br>
                    ğŸ’• åƒè›‹ç³•å›è¡€ï¼Œèº²å¼€éšœç¢ç‰©çš„æ’å‡»ï¼
                </p>
                <button class="btn" id="startBtn">å¼€å§‹å†’é™©</button>
            </div>
        </div>

        <!-- 2. å¤±è´¥/æš‚åœèœå• -->
        <div class="ui-overlay hidden" id="gameOverScreen">
            <div class="card">
                <h2>ğŸ˜µ æ™•å€’äº†ï¼</h2>
                <p>æµ·é‡Œçš„åƒåœ¾å¤ªå¤šäº†...<br>å°ç« é±¼éœ€è¦ä¼‘æ¯ä¸€ä¸‹ã€‚</p>
                <button class="btn" id="retryBtn">å†è¯•ä¸€æ¬¡</button>
            </div>
        </div>
    </div>

    <div id="celebrationWrapper">
        <canvas id="fwCanvas" style="position:absolute;top:0;left:0;"></canvas>
        <div class="cel-content">
            <div class="oct-show">
                <div class="hat-final">ğŸ‘‘</div>
                <div class="oct-head">
                    <div class="oct-eye l"></div><div class="oct-eye r"></div>
                    <div class="oct-mouth"></div>
                </div>
            </div>
            <h1 class="win-title">å°ç« é±¼ç”Ÿæ—¥å¿«ä¹ï¼</h1>
            <p style="font-size:1.4rem;">é‡åˆ°ä½ è¯´æ˜æˆ‘å¾ˆå¹¸è¿ï¼Œ<br>æ–°çš„ä¸€å¹´æˆ‘æŠŠå¥½è¿åˆ†ç»™ä½ ï¼</p>
        </div>
    </div>

    <script>
        /**
         * æ¸¸æˆæ ¸å¿ƒä»£ç 
         */
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('scoreEl');
        const lifeEl = document.getElementById('lifeEl');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const gameWrapper = document.getElementById('gameWrapper');
        
        let width, height;
        const TARGET = 23;

        // ç»‘å®šæŒ‰é’®äº‹ä»¶ (ä¿®å¤ç§»åŠ¨ç«¯ç‚¹å‡»é—®é¢˜)
        // ä½¿ç”¨ click äº‹ä»¶å³å¯ï¼Œä½†è¦æ³¨æ„ä¸è¦è®© global touchstart æ‹¦æˆª
        document.getElementById('startBtn').addEventListener('click', (e) => {
            e.stopPropagation(); // é˜»æ­¢å†’æ³¡
            startGame();
        });
        document.getElementById('retryBtn').addEventListener('click', (e) => {
            e.stopPropagation();
            startGame();
        });

        // å±å¹•é€‚é…
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- æ¸¸æˆçŠ¶æ€ ---
        let state = {
            playing: false,
            frames: 0,
            score: 0,
            hp: 3,
            speed: 3.5 // ç¨å¾®å¿«ä¸€ç‚¹ï¼Œæ›´åˆºæ¿€
        };

        let inputActive = false;

        // --- è¾“å…¥ç›‘å¬ ---
        // å…³é”®ä¿®å¤ï¼šåˆ¤æ–­ç‚¹å‡»ç›®æ ‡ï¼Œå¦‚æœæ˜¯UIæŒ‰é’®åˆ™ä¸è¦è§¦å‘æ¸¸æˆå†…çš„ä¸Šæµ®
        function handleInputStart(e) {
            if (e.target.tagName === 'BUTTON') return;
            if (state.playing) {
                // e.preventDefault(); // è§†æƒ…å†µå¼€å¯ï¼Œæœ‰æ—¶å€™ä¼šé˜»æ­¢é»˜è®¤æ»šåŠ¨
                inputActive = true;
            }
        }
        
        function handleInputEnd(e) {
            inputActive = false;
        }

        window.addEventListener('mousedown', handleInputStart);
        window.addEventListener('touchstart', handleInputStart, {passive: false});
        
        window.addEventListener('mouseup', handleInputEnd);
        window.addEventListener('touchend', handleInputEnd);
        
        window.addEventListener('keydown', (e) => { if(e.code==='Space') inputActive = true; });
        window.addEventListener('keyup', (e) => { if(e.code==='Space') inputActive = false; });

        // --- å®ä½“ç±»å®šä¹‰ ---

        // ä¸»è§’
        const player = {
            x: 50, y: height/2, r: 22, vy: 0,
            hurtTimer: 0, // æ— æ•Œæ—¶é—´
            draw() {
                // å—ä¼¤é—ªçƒ
                if(this.hurtTimer > 0) {
                    this.hurtTimer--;
                    if(Math.floor(Date.now()/50)%2===0) return;
                }

                ctx.save();
                ctx.translate(this.x, this.y);
                // æ—‹è½¬èº«ä½“
                let rot = inputActive ? -0.3 : 0.2;
                ctx.rotate(rot);

                // èº«ä½“
                ctx.fillStyle = '#ff9aa2';
                ctx.beginPath(); ctx.arc(0,0,this.r,0,Math.PI*2); ctx.fill();
                
                // è¡¨æƒ…å˜åŒ–
                ctx.fillStyle = '#fff';
                // çœ¼ç›
                if(this.hurtTimer > 0) {
                     // å—ä¼¤çœ¼ X X
                    ctx.strokeStyle = '#333'; ctx.lineWidth=2;
                    ctx.beginPath(); ctx.moveTo(4,-8); ctx.lineTo(12,-2); ctx.stroke();
                    ctx.beginPath(); ctx.moveTo(12,-8); ctx.lineTo(4,-2); ctx.stroke();
                } else {
                    ctx.beginPath(); ctx.arc(8,-5,6,0,Math.PI*2); ctx.fill();
                    ctx.fillStyle='#333'; ctx.beginPath(); ctx.arc(10,-5,2,0,Math.PI*2); ctx.fill();
                }
                
                // è§¦æ‰‹æ‘†åŠ¨
                ctx.fillStyle = '#ff9aa2';
                let legY = Math.sin(state.frames * 0.2) * 4;
                ctx.beginPath(); ctx.arc(-10, 18+legY, 7, 0, Math.PI*2); ctx.fill();
                ctx.beginPath(); ctx.arc(5, 20-legY, 7, 0, Math.PI*2); ctx.fill();

                ctx.restore();
            },
            update() {
                if(inputActive) this.vy -= 0.45; // ä¸Šæµ®åŠ›åº¦
                else this.vy += 0.25; // ä¸‹æ½œé‡åŠ›
                
                this.vy *= 0.96; // é˜»åŠ›
                this.y += this.vy;

                // ç¢°åˆ°å¤©èŠ±æ¿æˆ–åœ°æ¿
                if(this.y < this.r) { this.y = this.r; this.vy = 0; }
                if(this.y > height - this.r) { 
                    this.y = height - this.r; 
                    // ç¢°åˆ°åº•éƒ¨ä¹Ÿç¨å¾®å¼¹ä¸€ä¸‹
                    this.vy = -1; 
                }
            }
        };

        // ç‰©å“ç±» (åŸºç±»)
        class Item {
            constructor() {
                this.x = width + 50;
                this.y = Math.random() * (height - 100) + 50;
                this.markedForDeletion = false;
            }
            update() {
                this.x -= state.speed;
                if(this.x < -100) this.markedForDeletion = true;
            }
            draw() {} // å­ç±»å®ç°
            checkCollision(p) {
                // ç®€å•çš„åœ†å½¢ç¢°æ’
                let dx = this.x - p.x;
                let dy = this.y - p.y;
                let dist = Math.sqrt(dx*dx + dy*dy);
                return dist < (p.r + this.r);
            }
        }

        // 1. å¸½å­ (æ”¶é›†ç›®æ ‡)
        class Hat extends Item {
            constructor() { super(); this.r = 18; this.offset = Math.random()*100; }
            update() {
                super.update();
                this.y += Math.sin((state.frames + this.offset)*0.05) * 0.5; // ä¸Šä¸‹æµ®åŠ¨
            }
            draw() {
                ctx.save(); ctx.translate(this.x, this.y);
                ctx.fillStyle = '#ffd700'; // é‡‘è‰²
                ctx.beginPath(); ctx.moveTo(0,-20); ctx.lineTo(15,10); ctx.lineTo(-15,10); ctx.fill();
                ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(0,-20,4,0,Math.PI*2); ctx.fill();
                ctx.restore();
            }
        }

        // 2. è›‹ç³• (å›è¡€, ç¨€æœ‰)
        class Cake extends Item {
            constructor() { 
                super(); 
                this.r = 20; 
                // è›‹ç³•ç¨å¾®å¤§ä¸€ç‚¹ï¼Œå®¹æ˜“çœ‹åˆ°
            }
            draw() {
                ctx.save(); ctx.translate(this.x, this.y);
                // è›‹ç³•ä½“
                ctx.fillStyle = '#fff0f5'; ctx.fillRect(-15, -10, 30, 20);
                // å¥¶æ²¹å±‚
                ctx.fillStyle = '#ff6b6b'; ctx.fillRect(-15, -10, 30, 5);
                // æ¨±æ¡ƒ
                ctx.fillStyle = '#e55039'; ctx.beginPath(); ctx.arc(0, -12, 5, 0, Math.PI*2); ctx.fill();
                ctx.restore();
            }
        }

        // 3. æµ·èƒ† (æ—‹è½¬éšœç¢, å°)
        class Urchin extends Item {
            constructor() { super(); this.r = 20; this.angle = 0; }
            update() {
                super.update();
                this.angle += 0.1;
            }
            draw() {
                ctx.save(); ctx.translate(this.x, this.y);
                ctx.rotate(this.angle);
                ctx.fillStyle = '#2d3436';
                ctx.beginPath(); ctx.arc(0,0,10,0,Math.PI*2); ctx.fill();
                // åˆº
                for(let i=0; i<8; i++) {
                    ctx.rotate(Math.PI/4);
                    ctx.beginPath(); ctx.moveTo(0,-10); ctx.lineTo(3,-25); ctx.lineTo(-3,-25); ctx.fill();
                }
                ctx.restore();
            }
        }

        // 4. è‡­é´å­ (éšæœºæ—‹è½¬åƒåœ¾)
        class Boot extends Item {
            constructor() { 
                super(); 
                this.r = 25; 
                this.spin = (Math.random()-0.5) * 0.05; 
                this.rot = 0;
            }
            update() { super.update(); this.rot += this.spin; }
            draw() {
                ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(this.rot);
                ctx.fillStyle = '#636e72'; 
                // ç”»ä¸€ä¸ªLå½¢
                ctx.beginPath(); 
                ctx.moveTo(-10, -20); ctx.lineTo(10, -20); 
                ctx.lineTo(10, 10); ctx.lineTo(25, 10); 
                ctx.lineTo(25, 25); ctx.lineTo(-10, 25); 
                ctx.closePath(); ctx.fill();
                // è‡­æ°”
                ctx.fillStyle = '#55efc4'; ctx.globalAlpha=0.6;
                ctx.beginPath(); ctx.arc(0, -30, 5, 0, Math.PI*2); ctx.fill();
                ctx.globalAlpha=1;
                ctx.restore();
            }
        }

        // 5. é“é”š (å›ºå®šéšœç¢, è¾ƒå¤§)
        class Anchor extends Item {
            constructor() {
                super();
                this.r = 30;
                // è¦ä¹ˆåœ¨é¡¶ä¸Šï¼Œè¦ä¹ˆåœ¨åº•ä¸‹
                if (Math.random() > 0.5) {
                    this.y = 40; // é¡¶
                    this.isTop = true;
                } else {
                    this.y = height - 40; // åº•
                    this.isTop = false;
                }
            }
            draw() {
                ctx.save(); ctx.translate(this.x, this.y);
                ctx.fillStyle = '#2c3e50';
                // é”šèº«
                if(this.isTop) {
                    ctx.fillRect(-5, -50, 10, 60); // é“¾æ¡å‘ä¸Š
                    ctx.beginPath(); ctx.arc(0, 10, 20, 0, Math.PI, false); ctx.lineTo(0,0); ctx.fill();
                } else {
                    ctx.fillRect(-5, -10, 10, 60); // é“¾æ¡å‘ä¸‹(å‡è£…)
                    ctx.beginPath(); ctx.arc(0, -10, 20, 0, Math.PI, true); ctx.lineTo(0,0); ctx.fill();
                }
                ctx.restore();
            }
        }

        // --- ç®¡ç†å™¨ ---
        let items = [];
        let particles = [];

        function updateHUD() {
            scoreEl.innerText = state.score;
            // æ¸²æŸ“å¿ƒå¿ƒ
            let hearts = '';
            for(let i=0; i<state.hp; i++) hearts += 'â¤';
            for(let i=state.hp; i<3; i++) hearts += 'ğŸ¤'; // ç©ºå¿ƒ
            lifeEl.innerText = hearts;
        }

        function spawnParticles(x, y, color) {
            for(let i=0; i<10; i++) {
                particles.push({
                    x: x, y: y,
                    vx: (Math.random()-0.5)*8, vy: (Math.random()-0.5)*8,
                    life: 1, color: color
                });
            }
        }

        function startGame() {
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            state.playing = true;
            state.score = 0;
            state.hp = 3;
            state.frames = 0;
            items = [];
            particles = [];
            player.y = height/2; player.vy = 0; player.hurtTimer = 0;
            
            updateHUD();
            loop();
        }

        function gameOver() {
            state.playing = false;
            // éœ‡åŠ¨å±å¹•æ•ˆæœ
            gameWrapper.style.animation = 'shake 0.5s';
            setTimeout(() => gameWrapper.style.animation = '', 500);
            
            setTimeout(() => {
                gameOverScreen.classList.remove('hidden');
            }, 500);
        }

        function gameWin() {
            state.playing = false;
            // è½¬åœº
            const cel = document.getElementById('celebrationWrapper');
            gameWrapper.style.transform = 'translateY(-100vh)';
            cel.style.display = 'flex';
            setTimeout(() => {
                cel.style.opacity = 1;
                startFireworks();
            }, 500);
        }

        // ç»Ÿä¸€ç”Ÿæˆé€»è¾‘
        function spawner() {
            // å¸½å­ï¼šé¢‘ç‡è¾ƒé«˜
            if(state.frames % 60 === 0) items.push(new Hat());
            
            // éšœç¢ç‰©ï¼šéšæœºæ··åˆ
            if(state.frames % 90 === 0) {
                let r = Math.random();
                if(r < 0.4) items.push(new Urchin());
                else if(r < 0.7) items.push(new Boot());
                else items.push(new Anchor());
            }

            // è›‹ç³•ï¼šç¨€æœ‰ï¼Œå¦‚æœè¡€å°‘åˆ™æ¦‚ç‡å¢åŠ 
            let cakeRate = state.hp < 3 ? 0.005 : 0.001; 
            if(Math.random() < cakeRate) items.push(new Cake());
        }

        // --- ä¸»å¾ªç¯ ---
        function loop() {
            if(!state.playing) return;
            
            ctx.clearRect(0,0,width,height);
            state.frames++;

            player.update();
            player.draw();
            
            spawner();

            // æ›´æ–°ç‰©å“
            for (let i = items.length - 1; i >= 0; i--) {
                let it = items[i];
                it.update();
                it.draw();

                // ç¢°æ’åˆ¤å®š
                if (it.checkCollision(player)) {
                    // 1. ç¢°åˆ°å¸½å­
                    if (it instanceof Hat) {
                        state.score++;
                        items.splice(i, 1);
                        spawnParticles(it.x, it.y, '#ffd700');
                        if (state.score >= TARGET) gameWin();
                    }
                    // 2. ç¢°åˆ°è›‹ç³•
                    else if (it instanceof Cake) {
                        if (state.hp < 3) state.hp++;
                        items.splice(i, 1);
                        spawnParticles(it.x, it.y, '#ff6b6b');
                    }
                    // 3. ç¢°åˆ°éšœç¢ç‰© (æµ·èƒ†/é´å­/é”š)
                    else {
                        if (player.hurtTimer === 0) {
                            state.hp--;
                            player.hurtTimer = 60; // 1ç§’æ— æ•Œ
                            spawnParticles(player.x, player.y, '#333'); // é»‘çƒŸ
                            
                            // å±å¹•é—ªçº¢æç¤ºå—ä¼¤
                            gameWrapper.style.background = '#ff6b6b';
                            setTimeout(() => {
                                gameWrapper.style.background = 'linear-gradient(180deg, #4facfe 0%, #00f2fe 100%)';
                            }, 100);

                            if(state.hp <= 0) gameOver();
                        }
                    }
                    updateHUD();
                } 
                else if (it.markedForDeletion) {
                    items.splice(i, 1);
                }
            }

            // ç²’å­ç‰¹æ•ˆ
            for(let i=particles.length-1; i>=0; i--) {
                let p = particles[i];
                p.x += p.vx; p.y += p.vy; p.life -= 0.05;
                if(p.life <=0) { particles.splice(i,1); continue; }
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath(); ctx.arc(p.x, p.y, 3, 0, Math.PI*2); ctx.fill();
            }
            ctx.globalAlpha = 1;

            requestAnimationFrame(loop);
        }

        // --- çƒŸèŠ± (åº†ç¥ç”¨) ---
        function startFireworks() {
            const fwC = document.getElementById('fwCanvas');
            const fwCtx = fwC.getContext('2d');
            fwC.width = window.innerWidth;
            fwC.height = window.innerHeight;
            let fws = [];
            
            function createFW(x,y) {
                const colors = ['#f1c40f','#e74c3c','#9b59b6','#2ecc71'];
                const c = colors[Math.floor(Math.random()*colors.length)];
                for(let i=0;i<30;i++) {
                    fws.push({
                        x:x, y:y, color:c, 
                        vx:(Math.random()-0.5)*10, vy:(Math.random()-0.5)*10,
                        life:1
                    });
                }
            }

            setInterval(() => createFW(Math.random()*width, Math.random()*height/2), 800);

            function fwLoop() {
                fwCtx.clearRect(0,0,width,height);
                for(let i=fws.length-1; i>=0; i--) {
                    let p = fws[i];
                    p.x+=p.vx; p.y+=p.vy; p.vy+=0.1; p.life-=0.02;
                    fwCtx.globalAlpha=p.life; fwCtx.fillStyle=p.color;
                    fwCtx.beginPath(); fwCtx.arc(p.x,p.y,3,0,Math.PI*2); fwCtx.fill();
                    if(p.life<=0) fws.splice(i,1);
                }
                requestAnimationFrame(fwLoop);
            }
            fwLoop();
        }

    </script>
</body>
</html>
