<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é—¯å…³è§£é”å°ç« é±¼çš„ç”Ÿæ—¥æƒŠå–œ</title>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
    <style>
        /* --- å…¨å±€é€šç”¨è®¾ç½® --- */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'ZCOOL KuaiLe', cursive, sans-serif;
            background-color: #333;
            user-select: none; /* ç¦æ­¢é€‰ä¸­æ–‡æœ¬ */
            -webkit-user-select: none;
        }

        /* ==================== 
           ç¬¬ä¸€éƒ¨åˆ†ï¼šæ¸¸æˆç•Œé¢ UI 
           ==================== */
        #gameWrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%);
            z-index: 100; /* æ¸¸æˆå±‚çº§æœ€é«˜ */
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 1s ease;
        }

        canvas#gameCanvas {
            border: 4px solid #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            max-width: 100%;
            max-height: 100%;
        }

        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€åˆ°Canvasï¼Œé™¤éç‚¹æŒ‰é’® */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #scoreBoard {
            position: absolute;
            top: 10%;
            font-size: 4rem;
            color: white;
            text-shadow: 2px 2px 0px #333;
        }

        .message-box {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px 50px;
            border-radius: 20px;
            text-align: center;
            pointer-events: auto; /* æŒ‰é’®å¯ä»¥ç‚¹å‡» */
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            border: 4px solid #ff9ff3;
        }

        .hidden { display: none !important; }

        h2 { margin: 0 0 10px 0; color: #ff6b6b; font-size: 2rem; }
        p.tip { color: #666; font-size: 1.2rem; margin-bottom: 20px; }

        button.btn {
            background: #ff9ff3;
            border: none;
            padding: 15px 40px;
            font-size: 1.5rem;
            color: white;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'ZCOOL KuaiLe', sans-serif;
            transition: transform 0.1s;
            box-shadow: 0 5px 0 #d65db1;
        }
        button.btn:active {
            transform: translateY(5px);
            box-shadow: none;
        }

        /* ç§»åŠ¨ç«¯æ“ä½œæç¤ºå±‚ */
        #tapHint {
            position: absolute;
            bottom: 20%;
            color: rgba(255,255,255,0.7);
            font-size: 1.5rem;
            animation: blink 2s infinite;
        }

        /* ==================== 
           ç¬¬äºŒéƒ¨åˆ†ï¼šåº†ç¥ç•Œé¢ (é€šå…³åæ˜¾ç¤º) 
           ==================== */
        #celebrationWrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0; /* åˆå§‹é€æ˜ */
            pointer-events: none; /* åˆå§‹ä¸å¯ç‚¹å‡» */
            /* åº†ç¥èƒŒæ™¯ */
            background: linear-gradient(135deg, #2a0845 0%, #6441a5 50%, #feada6 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 2s ease;
        }

        /* --- ä»¥ä¸‹æ˜¯å¤ç”¨çš„åº†ç¥ç•Œé¢CSS --- */
        #fireworksCanvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .bunting {
            position: absolute;
            top: 0; width: 100%; height: 50px; z-index: 5;
            display: flex; justify-content: center;
        }
        .flag {
            width: 40px; height: 50px; background: #ff6b6b; margin: 0 10px;
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            transform-origin: top center;
            animation: swing 3s ease-in-out infinite;
        }
        .flag:nth-child(2n) { background: #feca57; animation-delay: 0.2s; }
        .flag:nth-child(3n) { background: #48dbfb; animation-delay: 0.4s; }

        .container {
            position: relative; z-index: 10; text-align: center;
            max-width: 600px;
            animation: popIn 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        h1.wishes {
            font-size: 3.5rem; color: #fff;
            text-shadow: 3px 3px 0 #ff9aa2, 0 0 20px rgba(255,255,255,0.5);
            line-height: 1.2;
        }

        .sub-text {
            font-size: 1.6rem; color: #fffde7;
            background: rgba(255,255,255,0.2);
            padding: 10px 20px; border-radius: 50px;
            margin-top: 15px; display: inline-block;
            backdrop-filter: blur(5px);
        }

        /* CSSç”»çš„å°ç« é±¼ */
        .octopus-scene { position: relative; height: 250px; width: 200px; margin: 0 auto; animation: deepFloat 4s ease-in-out infinite; }
        .octopus { position: absolute; top: 50px; left: 40px; width: 120px; z-index: 10; }
        .head {
            width: 120px; height: 110px; background: radial-gradient(circle at 30% 30%, #ffc3cd, #ff9aa2);
            border-radius: 50% 50% 45% 45%; position: relative;
        }
        .eye { width: 26px; height: 34px; background: #333; border-radius: 50%; position: absolute; top: 45px; }
        .eye.left { left: 25px; } .eye.right { right: 25px; }
        .eye::before { content: ''; width: 10px; height: 10px; background: white; border-radius: 50%; position: absolute; top: 8px; left: 6px; }
        .blush { width: 18px; height: 10px; background: #ff6b6b; opacity: 0.6; border-radius: 50%; position: absolute; top: 75px; }
        .blush.left { left: 15px; } .blush.right { right: 15px; }
        .mouth {
            position: absolute; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 16px; height: 10px; border-bottom: 3px solid #d6696b; border-radius: 0 0 50% 50%;
        }
        .legs { position: absolute; bottom: -15px; left: 5px; width: 110px; display: flex; justify-content: space-between; }
        .leg { width: 20px; height: 35px; background: #ff9aa2; border-radius: 0 0 20px 20px; animation: wiggle 2s infinite ease-in-out; }
        .hat {
            position: absolute; top: -45px; left: 35px; border-left: 25px solid transparent; 
            border-right: 25px solid transparent; border-bottom: 60px solid #74b9ff; transform: rotate(-10deg);
        }
        .hat::after { content: ''; position: absolute; top: 0; left: -8px; width: 16px; height: 16px; background: #fff; border-radius: 50%; transform: translateY(-50%); }

        @keyframes swing { 0%, 100% {transform: rotate(-5deg);} 50% {transform: rotate(5deg);} }
        @keyframes deepFloat { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-20px);} }
        @keyframes wiggle { 0%, 100% {transform: rotate(-10deg);} 50% {transform: rotate(10deg);} }
        @keyframes popIn { 0% {transform: scale(0);} 100% {transform: scale(1);} }
        @keyframes blink { 0%,100% {opacity:1;} 50% {opacity:0.3;} }

        @media (max-width: 600px) { h1.wishes { font-size: 2.2rem; } }
    </style>
</head>
<body>

    <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šæ¸¸æˆç•Œé¢ -->
    <div id="gameWrapper">
        <canvas id="gameCanvas" width="400" height="600"></canvas>
        
        <div class="ui-layer">
            <div id="scoreBoard">0</div>
            <div id="tapHint" class="hidden">ç‚¹å‡»å±å¹•æˆ–ç©ºæ ¼è·³è·ƒ</div>

            <!-- å¼€å§‹èœå• -->
            <div id="startScreen" class="message-box">
                <h2>è§£é”æƒŠå–œ</h2>
                <p class="tip">å¸®åŠ©å°ç« é±¼æ¸¸è¿‡ <b style="color:#ff6b6b; font-size:1.5rem">5</b> ä¸ªçŠç‘šç¤<br>é€šè¿‡å³å¯é¢†å–ç”Ÿæ—¥ç¥ç¦ï¼</p>
                <button class="btn" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
            </div>

            <!-- æ¸¸æˆç»“æŸèœå• -->
            <div id="gameOverScreen" class="message-box hidden">
                <h2>æ’åˆ°å•¦ï¼</h2>
                <p class="tip">å°±å·®ä¸€ç‚¹ç‚¹ï¼<br>åŠ æ²¹ï¼</p>
                <button class="btn" onclick="resetGame()">å†è¯•ä¸€æ¬¡</button>
            </div>
        </div>
    </div>

    <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šåº†ç¥ç•Œé¢ (é»˜è®¤éšè—) -->
    <div id="celebrationWrapper">
        <canvas id="fireworksCanvas"></canvas>
        
        <div class="bunting">
            <div class="flag"></div><div class="flag"></div><div class="flag"></div>
            <div class="flag"></div><div class="flag"></div><div class="flag"></div>
        </div>

        <div class="container">
            <div class="octopus-scene">
                <div class="octopus">
                    <div class="hat"></div>
                    <div class="head">
                        <div class="eye left"></div>
                        <div class="eye right"></div>
                        <div class="blush left"></div>
                        <div class="blush right"></div>
                        <div class="mouth"></div>
                        <div class="legs">
                            <div class="leg"></div><div class="leg"></div><div class="leg"></div>
                            <div class="leg"></div><div class="leg"></div>
                        </div>
                    </div>
                </div>
            </div>

            <h1 class="wishes">é€šå…³æˆåŠŸï¼<br>ç¥å°ç« é±¼<br>ç”Ÿæ—¥å¿«ä¹ï¼</h1>
            <div class="sub-text">ğŸ‰ 2025 å…ƒæ—¦å¿«ä¹ Â· æ¯å¤©éƒ½å¼€å¿ƒ ğŸ‰</div>
        </div>
    </div>

    <script>
        /*******************************
         * æ¸¸æˆé€»è¾‘ Script
         *******************************/
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('scoreBoard');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const tapHint = document.getElementById('tapHint');
        const gameWrapper = document.getElementById('gameWrapper');
        const celebrateWrapper = document.getElementById('celebrationWrapper');

        // æ¸¸æˆçŠ¶æ€
        let isPlaying = false;
        let frames = 0;
        let score = 0;
        const TARGET_SCORE = 5; // é€šå…³ç›®æ ‡

        // å°ç« é±¼å¯¹è±¡
        const octopus = {
            x: 50,
            y: 150,
            radius: 18,
            velocity: 0,
            gravity: 0.25,
            jump: 4.5,
            
            draw: function() {
                // èº«ä½“
                ctx.fillStyle = '#ff9ff3';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                // çœ¼ç›
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(this.x + 8, this.y - 5, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#333';
                ctx.beginPath();
                ctx.arc(this.x + 10, this.y - 5, 2, 0, Math.PI * 2);
                ctx.fill();
                // å°è§¦æ‰‹(è£…é¥°)
                ctx.fillStyle = '#ff9ff3';
                ctx.fillRect(this.x - 10, this.y + 10, 5, 10);
                ctx.fillRect(this.x + 5, this.y + 10, 5, 10);
            },
            
            update: function() {
                this.velocity += this.gravity;
                this.y += this.velocity;

                // åœ°é¢å’Œå¤©èŠ±æ¿æ£€æµ‹
                if (this.y + this.radius >= canvas.height || this.y - this.radius <= 0) {
                    gameOver();
                }
            },
            
            flap: function() {
                this.velocity = -this.jump;
            }
        };

        // éšœç¢ç‰© (çŠç‘š)
        const pipes = {
            items: [],
            width: 50,
            gap: 160, // å®½æ•ä¸€ç‚¹ï¼Œå®¹æ˜“è¿‡
            dx: 2, // ç§»åŠ¨é€Ÿåº¦

            draw: function() {
                ctx.fillStyle = '#ff6b6b'; // çŠç‘šè‰²
                for(let i=0; i<this.items.length; i++){
                    let p = this.items[i];
                    // ä¸ŠçŠç‘š (ç”»åœ†è§’çŸ©å½¢æ ·å­)
                    ctx.fillRect(p.x, 0, this.width, p.top);
                    ctx.fillRect(p.x - 5, p.top - 20, this.width + 10, 20); // çŠç‘šå¤´

                    // ä¸‹çŠç‘š
                    ctx.fillRect(p.x, canvas.height - p.bottom, this.width, p.bottom);
                    ctx.fillRect(p.x - 5, canvas.height - p.bottom, this.width + 10, 20); // çŠç‘šå¤´
                }
            },

            update: function() {
                // æ¯120å¸§ç”Ÿæˆä¸€ä¸ª
                if(frames % 120 === 0) {
                    // éšæœºé«˜åº¦
                    let topHeight = Math.random() * (canvas.height/2) + 50;
                    // ä¿è¯ä¸åšå¤ªéš¾
                    if(topHeight > canvas.height - this.gap - 50) topHeight = canvas.height - this.gap - 50; 
                    
                    this.items.push({
                        x: canvas.width,
                        top: topHeight,
                        bottom: canvas.height - (topHeight + this.gap)
                    });
                }

                for(let i=0; i<this.items.length; i++){
                    let p = this.items[i];
                    p.x -= this.dx;

                    // ç¢°æ’æ£€æµ‹
                    if(
                        octopus.x + octopus.radius > p.x && 
                        octopus.x - octopus.radius < p.x + this.width && 
                        (octopus.y - octopus.radius < p.top || octopus.y + octopus.radius > canvas.height - p.bottom)
                    ){
                        gameOver();
                    }

                    // åŠ åˆ†
                    if(p.x + this.width < octopus.x && !p.passed) {
                        score++;
                        scoreEl.innerText = score;
                        p.passed = true;
                        
                        // æ£€æŸ¥æ˜¯å¦é€šå…³
                        if(score >= TARGET_SCORE) {
                            GameWin();
                        }
                    }

                    // ç§»é™¤å‡ºå±å¹•çš„
                    if(p.x + this.width < 0) {
                        this.items.shift();
                        i--;
                    }
                }
            },
            
            reset: function(){
                this.items = [];
            }
        };

        // æ¸¸æˆå¾ªç¯
        function loop() {
            if(!isPlaying) return;

            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            pipes.update();
            pipes.draw();
            
            octopus.update();
            octopus.draw();

            frames++;
            requestAnimationFrame(loop);
        }

        // æ§åˆ¶é€»è¾‘
        function startGame() {
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            tapHint.classList.remove('hidden');
            resetVars();
            isPlaying = true;
            loop();
        }

        function resetGame() {
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            resetVars();
            isPlaying = true;
            loop();
        }

        function resetVars() {
            octopus.y = 150;
            octopus.velocity = 0;
            pipes.reset();
            score = 0;
            frames = 0;
            scoreEl.innerText = score;
        }

        function gameOver() {
            isPlaying = false;
            tapHint.classList.add('hidden');
            gameOverScreen.classList.remove('hidden');
        }

        function GameWin() {
            isPlaying = false;
            // éšè—æ¸¸æˆUI
            gameWrapper.style.opacity = '0';
            setTimeout(() => {
                gameWrapper.style.display = 'none';
                // æ˜¾ç¤ºåº†ç¥UI
                launchCelebration();
            }, 1000);
        }

        // è¾“å…¥ç›‘å¬
        window.addEventListener('keydown', (e) => {
            if(e.code === 'Space') {
                if(isPlaying) octopus.flap();
            }
        });
        
        window.addEventListener('touchstart', (e) => {
            if(isPlaying) {
                e.preventDefault(); 
                octopus.flap();
            }
        }, {passive: false});
        
        window.addEventListener('mousedown', (e) => {
             // åªæœ‰ç‚¹å‡» canvas åŒºåŸŸæ‰è·³è·ƒï¼Œé¿å…ç‚¹æŒ‰é’®æ—¶è¯¯è§¦
             if(e.target === canvas && isPlaying) {
                 octopus.flap();
             }
        });

        /*******************************
         * åº†ç¥é€»è¾‘ Script (å¤ç”¨ä¹‹å‰çš„)
         *******************************/
        function launchCelebration() {
            celebrateWrapper.style.opacity = '1';
            celebrateWrapper.style.pointerEvents = 'auto'; // å…è®¸ç‚¹å‡»æ”¾çƒŸèŠ±
            
            // å¯åŠ¨çƒŸèŠ±å¾ªç¯
            fireworksLoop();
        }

        const fwCanvas = document.getElementById('fireworksCanvas');
        const fwCtx = fwCanvas.getContext('2d');
        let particles = [];
        
        function resizeFw() {
            fwCanvas.width = window.innerWidth;
            fwCanvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeFw);
        resizeFw();

        document.addEventListener('click', (e) => {
            if(gameWrapper.style.display === 'none') {
                 createParticles(e.clientX, e.clientY);
            }
        });

        function createParticles(x, y) {
            const colors = ['#ff9ff3', '#feca57', '#ff6b6b', '#48dbfb', '#1dd1a1'];
            for(let i=0; i<30; i++) {
                particles.push({
                    x: x, y: y,
                    color: colors[Math.floor(Math.random()*colors.length)],
                    vx: (Math.random()-0.5)*10,
                    vy: (Math.random()-0.5)*10,
                    alpha: 1
                });
            }
        }

        function fireworksLoop() {
            requestAnimationFrame(fireworksLoop);
            if(gameWrapper.style.display !== 'none') return; // æ¸¸æˆæ²¡ç»“æŸä¸è·‘è¿™ä¸ª

            fwCtx.globalCompositeOperation = 'destination-out';
            fwCtx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            fwCtx.fillRect(0, 0, fwCanvas.width, fwCanvas.height);
            fwCtx.globalCompositeOperation = 'lighter';

            // è‡ªåŠ¨æ”¾çƒŸèŠ±
            if(Math.random() < 0.05) {
                createParticles(Math.random()*fwCanvas.width, Math.random()*fwCanvas.height/2);
            }

            for(let i=particles.length-1; i>=0; i--) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.1; // é‡åŠ›
                p.alpha -= 0.02;
                
                fwCtx.globalAlpha = p.alpha;
                fwCtx.fillStyle = p.color;
                fwCtx.beginPath();
                fwCtx.arc(p.x, p.y, 3, 0, Math.PI*2);
                fwCtx.fill();

                if(p.alpha <=0) particles.splice(i, 1);
            }
        }

    </script>
</body>
</html>
